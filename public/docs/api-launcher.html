<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentación API - Pasteleria Mil Sabores</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/CSS/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <link rel="icon" href="../assets/img/logo-fndo-blanco.png">
</head>
<body>
  <!-- HEADER -->
   <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <img src="../assets/img/logo-fndo-blanco.png" alt="icono" width="70" height="70" class="logo">
            <a href="../assets/page/home_admin.html" class="logo">Pastelería mil sabores</a>  <!-- que redireccione a la pág principal o dashboard -->
        </header>
    

        <!-- CONTENIDO PRINCIPAL -->
        <main class="main catalogo">
            <div class="checkout-container">
            <div class="checkout-header">
                <div class="checkout-titulos">
                <h1><i class="bi bi-book"></i> Documentación API</h1>
                <p class="checkout-subtitulo">Este lanzador abrirá Swagger Editor con la documentación de tu API Firebase.</p>
                </div>
            </div>

            <!-- Instrucciones -->
            <div class="info-cliente">
                <h2 class="section-title">Instrucciones</h2>
                <ol>
                <li>Haz clic en <strong>"Abrir Swagger Editor"</strong></li>
                <li>Se abrirá <strong>https://editor.swagger.io/</strong></li>
                <li><strong>PASO IMPORTANTE:</strong> Pega el contenido YAML manualmente</li>
                <li>¡Listo! Tendrás tu documentación interactiva</li>
                </ol>
            </div>

            <!-- Botones -->
            <div class="checkout-footer">
                <button id="launchBtn" class="btn-pagar-ahora" onclick="launchSwaggerEditor()">
                <i class="bi bi-box-arrow-up-right"></i> Abrir Swagger Editor
                </button>
                <button id="copyBtn" class="btn-agregar" onclick="copyYAMLContent()">
                <i class="bi bi-clipboard"></i> Copiar YAML
                </button>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading" style="display: none; text-align: center; margin: 20px 0;">
                <p>Abriendo Swagger Editor...</p>
            </div>

            <!-- Status -->
            <div id="status" class="mensaje-registro" style="display: none; margin-top: 20px;"></div>

            <!-- Troubleshooting -->
            <div class="direccion-entrega" style="margin-top: 30px;">
                <h3 class="section-title">¿Problemas?</h3>
                <p class="section-subtitle">Si el método automático no funciona:</p>
                <ol>
                <li>Haz clic en <strong>"Copiar YAML"</strong></li>
                <li>Ve manualmente a <a href="https://editor.swagger.io/" target="_blank">https://editor.swagger.io/</a></li>
                <li>Borra todo el contenido existente</li>
                <li>Pega el YAML copiado (Ctrl+V)</li>
                </ol>
            </div>
            </div>
        </main>
    </div>
  

  <script>
    // Contenido YAML completo
    const openapiContent = `openapi: 3.0.0
info:
  title: API Panel de Administración - Tienda Online
  description: Documentación de servicios Firebase Firestore - Los ejemplos son estáticos
  version: 1.0.0
servers:
  - url: https://firestore.googleapis.com/v1

tags:
  - name: Dashboard
  - name: Productos
  - name: Órdenes
  - name: Usuarios
  - name: Regiones
  - name: Contacto
  - name: Administrador

paths:
  /api/productos:
    get:
      tags:
        - Productos
      summary: Obtener lista de productos
      description: Obtiene todos los productos desde la colección "producto" de Firebase Firestore.
      responses:
        '200':
          description: Lista de productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producto'
    post:
      tags:
        - Productos
      summary: Crear un nuevo producto
      description: Crea un nuevo producto en la colección "producto" de Firebase Firestore.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
      responses:
        '201':
          description: Producto creado correctamente
  /api/productos/{id}:
    get:
      tags:
        - Productos
      summary: Obtener detalles de un producto
      description: Obtiene el producto desde la colección "producto" por su ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detalles del producto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
    put:
      tags:
        - Productos
      summary: Actualizar producto
      description: Actualiza un producto en la colección "producto" de Firebase Firestore.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'  # Revisión del $ref aquí
      responses:
        '200':
          description: Producto actualizado correctamente
    delete:
      tags:
        - Productos
      summary: Eliminar producto
      description: Elimina un producto de la colección "producto" en Firebase Firestore.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Producto eliminado correctamente

  /api/ordenes:
    get:
      tags:
        - Órdenes
      summary: Obtener lista de órdenes
      description: Obtiene todas las órdenes desde la colección "compras" de Firebase Firestore.
      responses:
        '200':
          description: Lista de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Orden'
    post:
      tags:
        - Órdenes
      summary: Crear una nueva orden
      description: Crea una nueva orden en la colección "compras" de Firebase Firestore.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrdenInput'  # Revisión del $ref aquí
      responses:
        '201':
          description: Orden creada correctamente
  /api/ordenes/{id}:
    get:
      tags:
        - Órdenes
      summary: Obtener detalles de una orden
      description: Obtiene los detalles de una orden desde la colección "compras" por su ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detalles de la orden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Orden'
    put:
      tags:
        - Órdenes
      summary: Actualizar estado de la orden
      description: Actualiza el estado de una orden en la colección "compras" de Firebase Firestore.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrdenInput'  # Revisión del $ref aquí
      responses:
        '200':
          description: Estado de la orden actualizado correctamente

  /api/usuarios:
    get:
      tags:
        - Usuarios
      summary: Obtener lista de usuarios
      description: Obtiene todos los usuarios desde la colección "usuario" de Firebase Firestore.
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'

  /api/region:
    get:
      tags:
        - Regiones
      summary: Obtener lista de regiones
      description: Obtiene todas las regiones desde la colección "region" de Firebase Firestore.
      responses:
        '200':
          description: Lista de regiones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Region'

  /api/contacto:
    post:
      tags:
        - Contacto
      summary: Enviar formulario de contacto
      description: Envía un mensaje desde el formulario de contacto y lo guarda en la colección "contacto".
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Contacto'
      responses:
        '201':
          description: Mensaje de contacto enviado correctamente
/api/admin:
    put:
      tags:
        - Administrador
      summary: Actualizar información del administrador
      description: Permite al administrador modificar su información en Firebase Authentication.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminInput'
      responses:
        '200':
          description: Información del administrador actualizada correctamente
components:
  schemas:
    Producto:
      type: object
      properties:
        id:
          type: string
        nombre:
          type: string
        descripcion:
          type: string
        precio:
          type: number
        precio_oferta:
          type: number
        stock:
          type: integer
        categoria:
          type: string
        image:
          type: string
        activo:
          type: boolean
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
    ProductoInput:
      type: object
      properties:
        nombre:
          type: string
        descripcion:
          type: string
        precio:
          type: number
        precio_oferta:
          type: number
        stock:
          type: integer
        categoria:
          type: string
        image:
          type: string
    Orden:
      type: object
      properties:
        cliente:
          type: object
          properties:
            nombre:
              type: string
            apellidos:
              type: string
            correo:
              type: string
        direccion:
          type: object
          properties:
            calle:
              type: string
            comuna:
              type: string
            departamento:
              type: string
            indicaciones:
              type: string
            region:
              type: string
        estado:
          type: string
        fecha:
          type: string
          format: date-time
        numeroOrden:
          type: string
        productos:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nombre:
                type: string
              categoria:
                type: string
              image:
                type: string
              precio:
                type: number
              precio_oferta:
                type: number
              stock:
                type: integer
              cantidad:
                type: integer
        total:
          type: number
    OrdenInput:
      type: object
      properties:
        cliente:
          type: object
          properties:
            nombre:
              type: string
            apellidos:
              type: string
            correo:
              type: string
        direccion:
          type: object
          properties:
            calle:
              type: string
            comuna:
              type: string
            departamento:
              type: string
            indicaciones:
              type: string
            region:
              type: string
        productos:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              cantidad:
                type: integer
    Region:
      type: object
      properties:
        nombre:
          type: string
        comuna:
          type: array
          items:
            type: string
    Usuario:
      type: object
      properties:
        nombre:
          type: string
        apellidos:
          type: string
        correo:
          type: string
        password:
          type: string
        confirmPassword:
          type: string
        fechaNacimiento:
          type: string
        comuna:
          type: string
        region:
          type: string
        direccion:
          type: string
        run:
          type: string
        codigoPromo:
          type: string
        descuento:
          type: number
        tieneCumpleHoy:
          type: boolean
        createdAt:
          type: string
          format: date-time
    Contacto:
      type: object
      properties:
        asunto:
          type: string
        email:
          type: string
        mensaje:
          type: string
        nombre:
          type: string
        tipo:
          type: string`;

    function launchSwaggerEditor() {
      const btn = document.getElementById('launchBtn');
      const loading = document.getElementById('loading');
      const status = document.getElementById('status');
      
      btn.disabled = true;
      loading.style.display = 'block';
      status.innerHTML = 'Abriendo Swagger Editor...';
      status.style.display = 'block';
      
      try {
        const swaggerUrl = `https://editor.swagger.io/`;
        window.open(swaggerUrl, '_blank');
        
        status.innerHTML = '<strong>✅ Swagger Editor abierto.</strong> Pega el contenido YAML manualmente.';
        
        setTimeout(() => {
          status.innerHTML += '<br><br><strong>Instrucción:</strong> Ve a la pestaña recién abierta, borra el contenido existente y pega el YAML.';
        }, 1000);
        
      } catch (error) {
        status.innerHTML = '❌ Error: ' + error.message;
      } finally {
        loading.style.display = 'none';
        setTimeout(() => {
          btn.disabled = false;
        }, 2000);
      }
    }

    function copyYAMLContent() {
      const status = document.getElementById('status');
      
      try {
        const tempTextArea = document.createElement('textarea');
        tempTextArea.value = openapiContent;
        document.body.appendChild(tempTextArea);
        tempTextArea.select();
        tempTextArea.setSelectionRange(0, 99999);
        
        const successful = document.execCommand('copy');
        document.body.removeChild(tempTextArea);
        
        if (successful) {
          status.innerHTML = '<strong>✅ YAML copiado al portapapeles!</strong><br>Ahora ve a <a href="https://editor.swagger.io/" target="_blank">Swagger Editor</a> y pega el contenido.';
          status.style.display = 'block';
        } else {
          status.innerHTML = '❌ No se pudo copiar. Intenta manualmente.';
          status.style.display = 'block';
        }
        
      } catch (error) {
        status.innerHTML = '❌ Error al copiar: ' + error.message;
        status.style.display = 'block';
      }
    }
  </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
      <script src="../assets/JS/saludo.js"></script>
    <script src="../assets/JS/home_admin.js"></script>
    <script src="../assets/JS/dashboard.js"></script>
    <script src="../assets/JS/crud-functions.js"></script>
</body>
</html>